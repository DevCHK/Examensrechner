<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notenrechner Stex (Sachsen-Anhalt)</title>
  <style>
    :root {
      --bg-color: #f9f9f9;
      --text-color: #333;
      --input-bg: #fff;
      --accent-color: #0077cc;
      --card-bg: #fff;
      --scale-bg: #e6f2ff;
      --highlight: #d0ebff;
    }

    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #eee;
      --input-bg: #2c2c2c;
      --accent-color: #3399ff;
      --card-bg: #2a2a2a;
      --scale-bg: #264d73;
      --highlight: #336699;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 1em;
      background-color: var(--bg-color);
      color: var(--text-color);
      max-width: 700px;
      margin: auto;
    }

    h1 {
      text-align: center;
      font-size: 1.6em;
      color: var(--accent-color);
    }

    label {
      display: block;
      margin-top: 1em;
      font-size: 1em;
    }

    input {
      width: 100%;
      padding: 0.6em;
      font-size: 1em;
      background: var(--input-bg);
      border: 1px solid #888;
      color: var(--text-color);
      border-radius: 5px;
      box-sizing: border-box;
    }

    button {
      margin-top: 2em;
      width: 100%;
      padding: 1em;
      font-size: 1.1em;
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 5px;
    }

    .result {
      margin-top: 2em;
      padding: 1em;
      background-color: var(--card-bg);
      border-radius: 5px;
    }

    .highlight {
      font-weight: bold;
      color: var(--accent-color);
    }

    .notenstufe {
      margin-top: 1em;
      padding: 1em;
      background: var(--scale-bg);
      border-radius: 5px;
    }

    .notenstufe table {
      width: 100%;
      border-collapse: collapse;
    }

    .notenstufe th, .notenstufe td {
      padding: 0.5em;
      border-bottom: 1px solid #aaa;
      text-align: left;
    }

    pre {
      background-color: #444;
      padding: 1em;
      border-radius: 5px;
      white-space: pre-wrap;
      font-family: monospace;
      margin-top: 1em;
      color: white;
    }

    .active-stufe {
      background-color: var(--highlight);
      font-weight: bold;
    }

    .topbar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 1em;
    }

    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.4em;
      cursor: pointer;
      color: var(--accent-color);
    }
  </style>
</head>
<body>
  <div class="topbar">
    <button class="theme-toggle" id="themeToggle">🌙</button>
  </div>

  <h1>Notenrechner Sachsen-Anhalt</h1>

  <form id="notenForm">
    <label>Strafrecht I:
      <input type="number" step="0.01" name="s1" />
    </label>
    <label>Strafrecht II:
      <input type="number" step="0.01" name="s2" />
    </label>
    <label>Zivilrecht I:
      <input type="number" step="0.01" name="z1" />
    </label>
    <label>Zivilrecht II:
      <input type="number" step="0.01" name="z2" />
    </label>
    <label>Öffentliches Recht I:
      <input type="number" step="0.01" name="ö1" />
    </label>
    <label>Öffentliches Recht II:
      <input type="number" step="0.01" name="ö2" />
    </label>
    <label>Mündliche Prüfung:
      <input type="number" step="0.01" name="mp" />
    </label>
    <label>Schwerpunktbereichsnote:
      <input type="number" step="0.01" name="sp" />
    </label>

    <button type="submit">Berechne Gesamtnote</button>
  </form>

  <div class="result" id="ergebnis" style="display:none;">
    <div id="noteAnzeigen"></div>
    <pre id="rechenweg"></pre>

    <div class="notenstufe">
      <strong>Notenskala:</strong>
      <table id="skala">
        <tr><td>Sehr gut</td><td>14.00 – 18.00</td></tr>
        <tr><td>Gut</td><td>11.50 – 13.99</td></tr>
        <tr><td>Vollbefriedigend (VB)</td><td>9.00 – 11.49</td></tr>
        <tr><td>Befriedigend</td><td>6.50 – 8.99</td></tr>
        <tr><td>Ausreichend</td><td>4.00 – 6.49</td></tr>
        <tr><td>Mangelhaft</td><td>1.50 – 3.99</td></tr>
        <tr><td>Ungenügend</td><td>0.00 – 1.49</td></tr>
      </table>
    </div>
  </div>

  <script>
    const form = document.getElementById("notenForm");
    const ergebnis = document.getElementById("ergebnis");
    const noteDiv = document.getElementById("noteAnzeigen");
    const rechenweg = document.getElementById("rechenweg");
    const skala = document.getElementById("skala");
    const toggle = document.getElementById("themeToggle");

    const notenstufen = [
      { stufe: "Sehr gut", von: 14.0, bis: 18.0 },
      { stufe: "Gut", von: 11.5, bis: 13.99 },
      { stufe: "Vollbefriedigend (VB)", von: 9.0, bis: 11.49 },
      { stufe: "Befriedigend", von: 6.5, bis: 8.99 },
      { stufe: "Ausreichend", von: 4.0, bis: 6.49 },
      { stufe: "Mangelhaft", von: 1.5, bis: 3.99 },
      { stufe: "Ungenügend", von: 0.0, bis: 1.49 }
    ];

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const get = name => parseFloat(form[name].value) || 0;
      const klausuren = ["s1", "s2", "z1", "z2", "ö1", "ö2"].map(name => get(name));
      const mp = get("mp");
      const sp = get("sp");

      const staatsteil = (
        klausuren.reduce((a, b) => a + b, 0) * 0.1 +
        mp * 0.4
      );

      const gesamt = staatsteil * 0.7 + sp * 0.3;
      const gesamtGerundet = Math.round(gesamt * 100) / 100;

      const stufe = notenstufen.find(n => gesamtGerundet >= n.von && gesamtGerundet <= n.bis);
      const nächste = notenstufen.find(n => n.von > gesamtGerundet);

      rechenweg.textContent = `Berechnung:

Staatsteil = (${klausuren.join(" + ")} x 10%) + (${mp} x 40%) 
            = ${staatsteil.toFixed(2)} Punkte

Gesamtnote = (${staatsteil.toFixed(2)} x 70%) + (${sp} x 30%) 
            = ${gesamtGerundet.toFixed(2)} Punkte`;

      noteDiv.innerHTML = `Gesamtnote: <span class="highlight">${gesamtGerundet.toFixed(2)}</span> Punkte<br />
Notenstufe: <strong>${stufe.stufe}</strong>${nächste ? `<br />Noch ${Math.round((nächste.von - gesamtGerundet) * 100) / 100} Punkte bis "${nächste.stufe}"` : ""}`;

      ergebnis.style.display = "block";

      Array.from(skala.rows).forEach(row => {
        row.classList.remove("active-stufe");
        if (row.cells[0].textContent === stufe.stufe) {
          row.classList.add("active-stufe");
        }
      });

      // Speicher Noten
      ["s1", "s2", "z1", "z2", "ö1", "ö2", "mp", "sp"].forEach(name => {
        localStorage.setItem(name, form[name].value);
      });
    });

    // Autofokus zum nächsten Feld
    const inputs = Array.from(form.querySelectorAll("input"));
    inputs.forEach((input, index) => {
      input.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          e.preventDefault();
          const next = inputs[index + 1];
          if (next) next.focus();
        }
      });

      // Daten laden
      const val = localStorage.getItem(input.name);
      if (val !== null) input.value = val;
    });

    // Dark Mode (System & Toggle)
    function applyTheme(theme) {
      document.body.classList.toggle("dark", theme === "dark");
      toggle.textContent = theme === "dark" ? "☀️" : "🌙";
    }

    toggle.addEventListener("click", () => {
      const isDark = document.body.classList.contains("dark");
      applyTheme(isDark ? "light" : "dark");
      localStorage.setItem("theme", isDark ? "light" : "dark");
    });

    const userPref = localStorage.getItem("theme") || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
    applyTheme(userPref);
  </script>
</body>
</html>
